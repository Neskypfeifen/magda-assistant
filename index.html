<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magda - Nesky Assistant</title>
    
    <link rel="icon" type="image/png" href="https://img.icons8.com/ios-filled/50/8B4513/fountain-pen-tip.png?v=9.3">
    <link rel="apple-touch-icon" href="https://img.icons8.com/ios-filled/150/8B4513/fountain-pen-tip.png?v=9.3">
    <meta name="theme-color" content="#8B4513">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FDFDFD; --card-bg: #FFFFFF; --accent-color: #8B4513;
            --text-main: #2D2D2D; --text-muted: #666666; --shadow: 0 4px 15px rgba(0,0,0,0.03);
        }
        body.night-mode {
            --bg-color: #1A1A1A; --card-bg: #262626; --text-main: #E0E0E0; --text-muted: #A0A0A0; --accent-color: #D2B48C;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; padding: 0; display: flex; justify-content: center; transition: 0.5s; }
        
        .app-container { width: 100%; max-width: 450px; min-height: 100vh; padding: 30px 20px 160px 20px; box-sizing: border-box; display: none; position: relative; }
        .app-visible { display: block; }
        
        header { margin-bottom: 25px; }
        h1 { font-size: 26px; font-weight: 600; margin: 0; }
        .date-summary { font-family: 'Playfair Display', serif; font-style: italic; font-size: 15px; color: var(--text-muted); margin-top: 5px; line-height: 1.4; }

        /* PRZYCISK G≈ÅOSOWY */
        .voice-btn {
            position: fixed; bottom: 30px; right: 25px; width: 65px; height: 65px;
            background: var(--accent-color); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; box-shadow: 0 6px 25px rgba(0,0,0,0.5);
            cursor: pointer; z-index: 9999; border: none; transition: transform 0.2s;
        }
        .voice-btn:active { transform: scale(0.9); }
        .voice-btn.listening { animation: pulse-red 1.5s infinite; background: #d32f2f; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7); } 70% { box-shadow: 0 0 0 25px rgba(211, 47, 47, 0); } 100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); } }

        .search-box { margin: 25px 0; position: relative; }
        .search-box input { width: 100%; padding: 15px 20px 15px 50px; border-radius: 35px; border: 1px solid rgba(0,0,0,0.1); background: var(--card-bg); color: var(--text-main); outline: none; box-shadow: var(--shadow); font-size: 16px; box-sizing: border-box; }
        .search-box::before { content: 'üîç'; position: absolute; left: 20px; top: 16px; font-size: 18px; opacity: 0.6; }

        .card { background: var(--card-bg); border-radius: 22px; padding: 22px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05); }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .small-card { background: var(--card-bg); border-radius: 20px; padding: 15px; border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow); }
        .small-card-title { font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 5px; }
        .small-card-value { font-size: 14px; font-weight: 600; }
        
        .news-section { display: grid; gap: 12px; margin-top: 15px; }
        .news-item { background: var(--card-bg); border-radius: 18px; padding: 18px; border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow); text-decoration: none; color: inherit; display: block; }
        .news-tag { font-size: 10px; font-weight: 700; color: var(--accent-color); text-transform: uppercase; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }
        .news-headline { font-size: 14px; font-weight: 500; line-height: 1.4; color: var(--text-main); }
        
        .joke-card { background: rgba(139, 69, 19, 0.04); border: 1px dashed var(--accent-color); padding: 25px; border-radius: 20px; font-size: 13px; font-style: italic; margin-top: 10px; text-align: center; line-height: 1.6; }
        
        #onboarding-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #FDFDFD; z-index: 100000; display: flex; flex-direction: column; align-items: center; padding: 60px 25px; box-sizing: border-box; }
        .btn-start { background: #8B4513; color: white; border: none; padding: 18px; border-radius: 35px; width: 100%; font-weight: 600; cursor: pointer; margin-top: 25px; font-size: 16px; }
        .onboarding-input { width: 100%; padding: 14px; margin-top: 12px; border-radius: 12px; border: 1px solid #ddd; background: #fff; font-size: 16px; box-sizing: border-box; }
    </style>
</head>
<body>

<button class="voice-btn" id="voice-trigger" onclick="startVoiceRecognition()">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
</button>

<div id="onboarding-overlay">
    <div style="max-width: 400px; width: 100%; text-align: center;">
        <img src="https://img.icons8.com/ios-filled/100/8B4513/fountain-pen-tip.png" alt="Logo" style="margin-bottom: 25px;">
        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px;">Magda v9.3</h2>
        <input type="text" id="user-name" class="onboarding-input" placeholder="Twoje Imiƒô">
        <input type="text" id="user-home" class="onboarding-input" placeholder="Miejscowo≈õƒá">
        <select id="user-transport" class="onboarding-input">
            <option value="samochodem">Samoch√≥d</option>
            <option value="rowerem">Rower</option>
            <option value="pieszo">Pieszo</option>
        </select>
        <button class="btn-start" onclick="saveAndStart()">Synchronizuj Dzie≈Ñ</button>
    </div>
</div>

<div id="main-app" class="app-container">
    <header>
        <h1 id="greeting-text">Witaj</h1>
        <p id="magda-intro" class="date-summary"></p>
    </header>

    <div class="search-box">
        <form action="https://www.google.com/search" method="GET" target="_blank">
            <input type="text" name="q" placeholder="Zapytaj Google...">
        </form>
    </div>

    <div class="status-grid">
        <div class="small-card">
            <div class="small-card-title">Pogoda</div>
            <div class="small-card-value" id="weather-val">12¬∞C, Pochmurno</div>
        </div>
        <div class="small-card">
            <div class="small-card-title">Logistyka</div>
            <div class="small-card-value" id="traffic-val">Ruch p≈Çynny</div>
        </div>
    </div>

    <div class="card">
        <div style="font-size: 11px; font-weight: 700; letter-spacing: 0.8px; color: var(--text-muted); margin-bottom: 10px;">LOKALIZACJA</div>
        <div id="location-text" style="font-size: 15px; font-weight: 600;">üìç Ustalanie...</div>
    </div>

    <h2 style="font-size: 18px; font-weight: 600; margin: 30px 0 10px 0;">Kurier i Pasje</h2>
    <div id="news-feed" class="news-section"></div>

    <div id="daily-joke" class="joke-card"></div>
</div>

<script>
    window.onload = function() {
        if(localStorage.getItem('magda_setup_done')) { showApp(); }
    };

    function saveAndStart() {
        localStorage.setItem('nesky_name', document.getElementById('user-name').value || "Tomku");
        localStorage.setItem('nesky_home', document.getElementById('user-home').value || "Erlenbach");
        localStorage.setItem('nesky_transport', document.getElementById('user-transport').value);
        localStorage.setItem('magda_setup_done', 'true');
        showApp();
    }

    function showApp() {
        document.getElementById('onboarding-overlay').style.display = 'none';
        document.getElementById('main-app').classList.add('app-visible');
        updateAllData();
    }

    async function updateAllData() {
        const name = localStorage.getItem('nesky_name');
        const homeCity = localStorage.getItem('nesky_home');
        const transport = localStorage.getItem('nesky_transport');
        const now = new Date();
        const hour = now.getHours();

        document.getElementById('greeting-text').innerText = `${hour < 18 ? "Dzie≈Ñ dobry" : "Dobry wiecz√≥r"}, ${name}`;
        
        // Domy≈õlne warto≈õci na wypadek braku GPS
        document.getElementById('location-text').innerText = `üìç ${homeCity}`;
        document.getElementById('magda-intro').innerText = `W ${homeCity} zapowiada siƒô ciekawa ≈õroda. Magda czuwa.`;
        document.getElementById('traffic-val').innerText = `Podr√≥≈º ${transport} OK`;

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(async (pos) => {
                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                    const data = await res.json();
                    const city = data.address.village || data.address.town || data.address.city || homeCity;
                    document.getElementById('location-text').innerText = `üìç ${city}`;
                    document.getElementById('magda-intro').innerText = `W ${city} niebo ma dzi≈õ kolor starego wrzo≈õca. Idealnie do warsztatu.`;
                    document.getElementById('weather-val').innerText = `8¬∞C, Rze≈õko`;
                    document.getElementById('traffic-val').innerText = `Trasa ${transport}: p≈Çynna`;
                } catch (e) { console.log("Lokalizacja z pamiƒôci."); }
            });
        }

        // Newsy
        const news = [
            { tag: "FC Bayern", title: "Bayern przygotowuje siƒô do kolejnego starcia w Bundeslidze.", link: "https://www.kicker.de/bayern-muenchen/info" },
            { tag: "Technologia", title: "Niemiecka in≈ºynieria vs AI: nowy raport Heise.", link: "https://www.heise.de/" },
            { tag: "Motoryzacja", title: "Testujemy nowƒÖ limuzynƒô z Bawarii - czy to kr√≥l szos?", link: "https://www.auto-motor-und-sport.de/" }
        ];

        document.getElementById('news-feed').innerHTML = news.map(n => `
            <a href="${n.link}" target="_blank" class="news-item">
                <span class="news-tag">${n.tag}</span>
                <span class="news-headline">${n.title}</span>
            </a>
        `).join('');

        document.getElementById('daily-joke').innerText = "In≈ºynier widzi, ≈ºe szklanka ma po prostu dwa razy wiƒôkszƒÖ objƒôto≈õƒá ni≈º potrzeba.";
    }

    function startVoiceRecognition() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) return alert("Brak obs≈Çugi mowy.");
        const recognition = new SpeechRecognition();
        recognition.lang = 'pl-PL';
        recognition.onstart = () => { document.getElementById('voice-trigger').classList.add('listening'); };
        recognition.onresult = (event) => {
            const cmd = event.results[0][0].transcript.toLowerCase();
            if (cmd.includes("szukaj")) {
                const query = cmd.split("szukaj")[1].trim();
                window.open(`https://www.google.com/search?q=${query}`, '_blank');
            } else if (cmd.includes("≈ºart") || cmd.includes("dowcip")) { updateAllData(); }
        };
        recognition.onend = () => { document.getElementById('voice-trigger').classList.remove('listening'); };
        recognition.start();
    }
</script>

</body>
</html>
 
